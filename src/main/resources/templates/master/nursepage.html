<!DOCTYPE html>
<html
        lang="en"
        class="light-style layout-menu-fixed"
        dir="ltr"
        data-theme="theme-default"
        data-assets-path="../assets/"
        data-template="vertical-menu-template-free"
        xmlns:th="http://www.thymeleaf.org"
>
<head>
  <div th:replace="~{master/head::head}"></div>
  <!-- Thêm CSS cần thiết -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    .rating-bar {
      height: 10px;
      background-color: #ddd;
      border-radius: 5px;
      width: 100%;
    }
    .rating-fill {
      height: 100%;
      background-color: #ff9800;
      transition: width 0.5s ease-in-out;
    }
  </style>
</head>

<body>
<div class="layout-wrapper layout-content-navbar">
  <div class="layout-container">
    <!-- Menu -->
    <div th:replace="~{master/layoutmenu::menu}"></div>
    <!-- / Menu -->

    <!-- Layout container -->
    <div class="layout-page">
      <!-- Navbar -->
      <div th:replace="~{master/navbar}"></div>
      <!-- / Navbar -->

      <!-- Content wrapper -->
      <div class="content-wrapper">
        <!-- Content -->
        <div class="content-xxl flex-grow-1 container-p-y">
          <div class="container mt-5">
            <h2 class="text-center mb-4">Danh sách Y Tá</h2>

            <!-- Hiển thị thông báo lỗi nếu có -->
            <div th:if="${error}" class="alert alert-danger" role="alert">
              <span th:text="${error}"></span>
            </div>

            <!-- Bộ lọc -->
            <div class="row mb-4">
              <div class="col-md-4">
                <label for="locationFilter">Vị trí:</label>
                <select id="locationFilter" class="form-control">
                  <option value="">Chọn vị trí</option>
                  <option value="Hà Nội">Hà Nội</option>
                  <option value="TPHCM">TPHCM</option>
                  <option value="Đà Nẵng">Đà Nẵng</option>
                </select>
              </div>
              <div class="col-md-4">
                <label for="skillsFilter">Kỹ năng:</label>
                <select id="skillsFilter" class="form-control">
                  <option value="">Chọn kỹ năng</option>
                  <option value="Da Liễu">Da Liễu</option>
                  <option value="Nội Khoa">Nội Khoa</option>
                  <option value="Mắt">Mắt</option>
                </select>
              </div>
              <div class="col-md-4">
                <label for="experienceFilter">Năm kinh nghiệm:</label>
                <select id="experienceFilter" class="form-control">
                  <option value="">Chọn năm kinh nghiệm</option>
                  <option value="1">1 năm</option>
                  <option value="2">2 năm</option>
                  <option value="3">3 năm</option>
                  <option value="4">4 năm</option>
                </select>
              </div>
            </div>

            <!-- Danh sách y tá động -->
            <div class="row" id="nurseList">
              <div th:if="${nurses != null and not #lists.isEmpty(nurses)}"
                   th:each="nurse : ${nurses}"
                   class="col-md-4 mb-4 nurse-card"
                   th:attr="data-location=${nurse.location}, data-skills=${nurse.skills}, data-experience=${nurse.experienceYears}">
                <div class="card">
                  <img th:src="${nurse.profileImage != null ? nurse.profileImage : '/assets/img/default_profile.jpg'}" class="card-img-top" alt="Ảnh Y Tá">
                  <div class="card-body">
                    <h5 class="card-title" th:text="${nurse.user.fullName} + ' | ' + ${nurse.skills}"></h5>
                    <p class="card-text" th:text="'Chuyên trị: ' + (${nurse.bio} != null ? ${nurse.bio} : 'Chưa có thông tin')"></p>
                    <p class="card-text">
                      <strong>Lịch khám:</strong>
                      <span th:if="${nurse.nurseAvailabilities != null and not #lists.isEmpty(nurse.nurseAvailabilities)}"
                            th:text="${#strings.join(nurse.nurseAvailabilities.![dayOfWeek + ' ' + startTime + '-' + endTime], ', ')}">
                      </span>
                      <span th:unless="${nurse.nurseAvailabilities != null and not #lists.isEmpty(nurse.nurseAvailabilities)}">
                        Chưa có lịch
                      </span>
                    </p>
                    <p class="card-text"><strong>Giá khám:</strong> <span th:text="${nurse.hourlyRate} + 'đ'"></span></p>
                    <a th:href="@{/nurse_review(nurseId=${nurse.user.userId})}" class="btn btn-link">Xem chi tiết</a>
                    <a th:href="@{/set_service(userId=${nurse.user.userId})}" class="btn btn-primary">Đặt dịch vụ</a>
                  </div>
                  <div class="card-footer">
                    <small class="text-muted">Bác sĩ Chuyên Khoa</small>
                  </div>
                </div>
              </div>
              <div th:if="${nurses == null or #lists.isEmpty(nurses)}" class="col-12">
                <p class="text-center">Không có y tá nào để hiển thị.</p>
              </div>
            </div>
          </div>
        </div>
        <!-- / Content -->
      </div>
      <!-- / Content wrapper -->
    </div>
    <!-- / Layout page -->
  </div>
  <!-- / Layout container -->
</div>

<!-- Core JS -->
<script src="/assets/vendor/libs/jquery/jquery.js"></script>
<script src="/assets/vendor/libs/popper/popper.js"></script>
<script src="/assets/vendor/js/bootstrap.js"></script>
<script src="/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
<script src="/assets/vendor/js/menu.js"></script>

<!-- Main JS -->
<script src="/assets/js/main.js"></script>

<!-- Page JS -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<!-- JavaScript cho bộ lọc -->
<script>
  document.getElementById('locationFilter').addEventListener('change', filterNurses);
  document.getElementById('skillsFilter').addEventListener('change', filterNurses);
  document.getElementById('experienceFilter').addEventListener('change', filterNurses);

  function filterNurses() {
    const location = document.getElementById('locationFilter').value.toLowerCase();
    const skills = document.getElementById('skillsFilter').value.toLowerCase();
    const experience = document.getElementById('experienceFilter').value;

    const nurses = document.querySelectorAll('.nurse-card');
    nurses.forEach(function(nurse) {
      const nurseLocation = nurse.getAttribute('data-location').toLowerCase();
      const nurseSkills = nurse.getAttribute('data-skills').toLowerCase();
      const nurseExperience = nurse.getAttribute('data-experience');

      if ((location === '' || nurseLocation.includes(location)) &&
              (skills === '' || nurseSkills.includes(skills)) &&
              (experience === '' || parseInt(nurseExperience) >= parseInt(experience))) {
        nurse.style.display = 'block';
      } else {
        nurse.style.display = 'none';
      }
    });
  }
</script>
</body>
</html>