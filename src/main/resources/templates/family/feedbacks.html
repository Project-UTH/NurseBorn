<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <title>Đánh Giá Y Tá</title>
    <div th:replace="~{master/head::head}"></div>
    <style>
        /* Modal (Popup) */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .modal-content h5 {
            color: #4a90e2;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 10px;
        }

        /* Nút đóng modal */
        .close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: #ff6f61;
            text-decoration: none;
        }

        /* Form đánh giá */
        .rating {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .rating input[type="radio"] {
            display: none;
        }

        .rating label {
            font-size: 30px;
            color: #ccc;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .rating input[type="radio"]:checked ~ label,
        .rating label:hover,
        .rating label:hover ~ label {
            color: #ff6f61;
        }

        .rating label:hover ~ label {
            color: #ccc;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
        }

        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            resize: vertical;
        }

        .form-group button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #4a90e2;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .form-group button:hover {
            background-color: #357abd;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .modal-content {
                width: 95%;
                margin: 20% auto;
            }

            .modal-content h5 {
                font-size: 20px;
            }

            .rating label {
                font-size: 24px;
            }

            .form-group textarea,
            .form-group button {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
<div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
        <div th:replace="~{family/layoutmenu_family::menu-family}"></div>
        <div class="layout-page">
            <div th:replace="~{profile/navbar-family::navbar-family}"></div>
            <div class="content-wrapper">
                <div class="content-xxl flex-grow-1 container-p-y">
                    <!-- Feedback Content -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title text-center">Đánh Giá Y Tá</h5>
                            <div th:if="${completedBookings.isEmpty()}">
                                <p class="text-center">Không có lịch đặt nào đã hoàn thành để đánh giá.</p>
                            </div>
                            <div th:unless="${completedBookings.isEmpty()}">
                                <table class="table table-bordered">
                                    <thead>
                                    <tr>
                                        <th>Ngày Đặt</th>
                                        <th>Y Tá</th>
                                        <th>Loại Dịch Vụ</th>
                                        <th>Hành Động</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="booking : ${completedBookings}">
                                        <td th:text="${#dates.format(booking.createdAt, 'dd-MM-yyyy HH:mm:ss')}"></td>
                                        <td th:text="${booking.nurseUser.fullName}"></td>
                                        <td th:text="${booking.serviceType}"></td>
                                        <td>
                                            <button class="btn btn-primary" th:onclick="'openFeedbackModal(' + ${booking.bookingId} + ')'">Đánh Giá</button>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal đánh giá -->
<div id="feedbackModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeFeedbackModal()">×</span>
        <h5>Đánh Giá Y Tá</h5>
        <form th:action="@{/family/rate-booking}" method="post">
            <input type="hidden" name="bookingId" id="bookingId">
            <div class="form-group">
                <label for="rating">Đánh Giá (Số Sao):</label>
                <div class="rating" id="rating">
                    <input type="radio" id="star5" name="rating" value="5">
                    <label for="star5" onclick="setRating(5)">★</label>
                    <input type="radio" id="star4" name="rating" value="4">
                    <label for="star4" onclick="setRating(4)">★</label>
                    <input type="radio" id="star3" name="rating" value="3">
                    <label for="star3" onclick="setRating(3)">★</label>
                    <input type="radio" id="star2" name="rating" value="2">
                    <label for="star2" onclick="setRating(2)">★</label>
                    <input type="radio" id="star1" name="rating" value="1">
                    <label for="star1" onclick="setRating(1)">★</label>
                </div>
            </div>
            <div class="form-group">
                <label for="comment">Phản Hồi:</label>
                <textarea id="comment" name="comment" rows="4" placeholder="Nhập phản hồi của bạn..."></textarea>
            </div>
            <div class="form-group">
                <button type="submit">Gửi Đánh Giá</button>
            </div>
        </form>
    </div>
</div>

<!-- Core JS -->
<script src="/static/assets/vendor/libs/jquery/jquery.js"></script>
<script src="/static/assets/vendor/libs/popper/popper.js"></script>
<script src="/static/assets/vendor/js/bootstrap.js"></script>
<script src="/static/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
<script src="/static/assets/vendor/js/menu.js"></script>
<script src="/static/assets/vendor/libs/apex-charts/apexcharts.js"></script>
<script src="/static/assets/js/main.js"></script>
<script src="/static/assets/js/dashboards-analytics.js"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>

<script>
    function openFeedbackModal(bookingId) {
        var modal = document.getElementById("feedbackModal");
        var bookingIdInput = document.getElementById("bookingId");
        bookingIdInput.value = bookingId;
        modal.style.display = "block";
    }

    function closeFeedbackModal() {
        var modal = document.getElementById("feedbackModal");
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        var modal = document.getElementById("feedbackModal");
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    function setRating(value) {
        var stars = document.querySelectorAll('.rating input[type="radio"]');
        stars.forEach(function(star) {
            star.checked = false;
            if (star.value <= value) {
                star.nextElementSibling.style.color = "#ff6f61";
            } else {
                star.nextElementSibling.style.color = "#ccc";
            }
        });
        document.getElementById("star" + value).checked = true;
    }
</script>
</body>
</html>